<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Calculadora de Dominio y Rango</title>
  <script src="https://cdn.jsdelivr.net/npm/mathjs@11.11.1/lib/browser/math.js"></script>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 40px;
      background-color: #f9f9f9;
    }
    h2, h3 {
      color: #1a1a1a;
    }
    input, button {
      padding: 8px;
      font-size: 16px;
      margin-right: 10px;
    }
    table {
      border-collapse: collapse;
      margin-top: 20px;
      width: 400px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 6px 10px;
      text-align: center;
    }
    th {
      background-color: #eee;
    }
    .section {
      margin-top: 30px;
    }
  </style>
</head>
<body>
  <h2>Calculadora de Dominio y Rango</h2>

  <label>Ingrese una función en términos de <code>x</code>:</label>
  <input type="text" id="funcion" placeholder="Ej: 1/(x-2), sqrt(x), x^2 + 3">
  <button onclick="calcular()">Calcular</button>

  <div class="section">
    <h3>Resultado</h3>
    <p><strong>Dominio:</strong> <span id="dominio"></span></p>
    <p><strong>Rango:</strong> <span id="rango"></span></p>
  </div>

  <div class="section">
    <div id="grafica" style="width: 700px; height: 500px;"></div>
  </div>

  <div class="section">
    <h3>Fragmento de tabla de valores (x, f(x))</h3>
    <table id="tabla">
      <thead>
        <tr><th>x</th><th>f(x)</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <div class="section">
    <h3>Explicación</h3>
    <p>Esta herramienta analiza el comportamiento de la función evaluando valores de <code>x</code> entre -100 y 100, en pasos de 0.1.</p>
    <ul>
      <li>Se excluyen automáticamente los puntos donde la función no está definida.</li>
      <li>Se muestran las discontinuidades como <strong>asíntotas verticales</strong> (líneas rojas punteadas).</li>
      <li>El dominio estimado considera los valores donde la función existe y produce resultados numéricos válidos.</li>
      <li>El rango se determina a partir de los valores válidos de f(x), sin considerar infinitos.</li>
    </ul>
  </div>

  <script>
    function calcular() {
      const input = document.getElementById("funcion").value;
      const expr = math.parse(input);
      const f = expr.compile();

      const xDesde = -100, xHasta = 100, paso = 0.1;

      const segmentos = [];
      let xSegmento = [], ySegmento = [];

      const tablaDatos = [];
      let discontinuidades = [];
      let domMin = null, domMax = null, ranMin = null, ranMax = null;

      for (let x = xDesde; x <= xHasta; x += paso) {
        let y;
        try {
          y = f.evaluate({ x: x });
          if (!isFinite(y) || Math.abs(y) > 1e6) throw 'infinito';

          if (domMin === null || x < domMin) domMin = x;
          if (domMax === null || x > domMax) domMax = x;
          if (ranMin === null || y < ranMin) ranMin = y;
          if (ranMax === null || y > ranMax) ranMax = y;

          xSegmento.push(x);
          ySegmento.push(y);

          if (tablaDatos.length < 20 && Math.abs(x % 1) < 0.001) {
            tablaDatos.push({ x: x.toFixed(2), y: y.toFixed(4) });
          }

        } catch {
          if (xSegmento.length > 1) {
            segmentos.push({ x: [...xSegmento], y: [...ySegmento] });
          }
          discontinuidades.push(x.toFixed(2));
          xSegmento = [];
          ySegmento = [];
        }
      }

      if (xSegmento.length > 1) {
        segmentos.push({ x: [...xSegmento], y: [...ySegmento] });
      }

      // Mostrar dominio y rango
      document.getElementById("dominio").innerText =
        `Aproximadamente: [${domMin.toFixed(2)}, ${domMax.toFixed(2)}]` +
        (discontinuidades.length ? ` con discontinuidades en x = ${discontinuidades.join(", ")}` : "");

      document.getElementById("rango").innerText =
        `Aproximadamente: [${ranMin.toFixed(2)}, ${ranMax.toFixed(2)}]`;

      // Mostrar tabla
      const cuerpo = document.querySelector("#tabla tbody");
      cuerpo.innerHTML = '';
      tablaDatos.forEach(par => {
        const fila = document.createElement("tr");
        fila.innerHTML = `<td>${par.x}</td><td>${par.y}</td>`;
        cuerpo.appendChild(fila);
      });

      // Graficar
      const trazos = segmentos.map(seg => ({
        x: seg.x,
        y: seg.y,
        mode: 'lines',
        type: 'scatter',
        line: { color: 'blue', width: 2 },
        hoverinfo: 'x+y'
      }));

      // Asíntotas verticales
      discontinuidades.forEach(xVal => {
        trazos.push({
          x: [xVal, xVal],
          y: [ranMin - 1, ranMax + 1],
          mode: 'lines',
          line: { dash: 'dot', color: 'red', width: 1.5 },
          name: 'Asíntota vertical',
          hoverinfo: 'none',
          showlegend: false
        });
      });

      Plotly.newPlot('grafica', trazos, {
        title: 'Gráfica de la Función',
        xaxis: { title: 'x' },
        yaxis: { title: 'f(x)', range: [ranMin - 1, ranMax + 1] },
        margin: { t: 50 }
      });
    }
  </script>
</body>
</html>
